<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Workshop System Config Editor</title>
  <link href="https://fontlibrary.org/face/osp-din" rel="stylesheet" type="text/css" />
  <style>
    :root {
      --bg: #000;
      --text: #fff;
      --accent: #d4af37;
    }

    body {
      font-family: 'OSP-DIN', sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 2em;
    }

    h1 {
      color: var(--text);
      margin-bottom: 2em;
      font-weight: normal;
      text-transform: uppercase;
      font-size: 2.5em;
      letter-spacing: 1px;
    }

    .grid {
      display: grid;
      grid-auto-flow: row;
      grid-template-columns: auto repeat(2, 1fr);
      gap: 2em;
      align-items: start;
    }

    .field-label {
      font-weight: bold;
      padding: 0.7em 0;
      border-left: 6px solid var(--accent);
      padding-left: 1em;
      text-transform: uppercase;
      color: var(--text);
      font-size: 1.5em;
    }

    .field-cell {
      display: flex;
      flex-wrap: wrap;
      gap: 1em;
    }

    button {
      padding: 1em 2em;
      font-size: 1.25em;
      font-family: 'OSP-DIN', sans-serif;
      border: 2px solid var(--accent);
      background: var(--bg);
      color: var(--text);
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      text-transform: uppercase;
    }

    button:hover {
      background: #111;
    }

    button.active {
      background: var(--text);
      color: var(--bg);
      border-color: var(--text);
    }

    .column-header {
      font-weight: bold;
      text-align: center;
      padding-bottom: 0.5em;
      color: var(--accent);
      text-transform: uppercase;
      font-size: 1.25em;
    }

    @media (max-width: 800px) {
      .grid {
        grid-template-columns: auto 1fr;
      }

      .column-header:nth-child(n+3) {
        display: none;
      }

      .grid > .field-cell:nth-child(3n+3) {
        display: none;
      }
    }
  </style>
</head>
<body>

  <h1>Workshop System Config Editor</h1>
  <div id="preset-grid" class="grid"></div>

  <script>
    const presets = [
      {
        name: "Scale",
        key: "scale",
        labels: ["Chrom", "Major", "Minor", "Minor Pent", "Dorian", "Pelog", "Wholetone"],
        repeat: 2,
      },
      {
        name: "Range",
        key: "range",
        labels: ["1", "2", "3", "4", "5", "6"],
        repeat: 2,
      },
      {
        name: "Loop Length",
        key: "looplen",
        labels: ["2", "4", "8", "16"],
        repeat: 2,
      },
      {
        name: "Pulse Mode",
        key: "pulseMode1",
        labels: ["Off", "On"],
        repeat: 2,
      },
    ];

    const currentValues = {};

    function sendUpdate(field, value) {
      currentValues[field] = value;
      console.log(`sendUpdate('${field}', ${value})`);
      updateActiveStates();
    }

    function updateActiveStates() {
      document.querySelectorAll("button").forEach(btn => {
        const field = btn.getAttribute("data-field");
        const value = parseInt(btn.getAttribute("data-value"));
        const isActive = currentValues[field] === value;
        btn.classList.toggle("active", isActive);
      });
    }

    function createGrid() {
      const container = document.getElementById("preset-grid");
      const maxRepeat = Math.max(...presets.map(p => p.repeat || 1));

      container.appendChild(document.createElement("div")); // top-left corner

      for (let col = 0; col < maxRepeat; col++) {
        const header = document.createElement("div");
        header.className = "column-header";
        header.textContent = `Preset ${col}`;
        container.appendChild(header);
      }

      presets.forEach((field) => {
        const rowLabel = document.createElement("div");
        rowLabel.className = "field-label";
        rowLabel.textContent = field.name;
        container.appendChild(rowLabel);

        const repeatCount = field.repeat || 1;

        for (let i = 0; i < maxRepeat; i++) {
          const cell = document.createElement("div");
          cell.className = "field-cell";

          if (i < repeatCount) {
            const fieldName = `preset${i}.${field.key}`;

            field.labels.forEach((labelText, valueid) => {
              const btn = document.createElement("button");
              btn.innerText = labelText;
              btn.setAttribute("data-field", fieldName);
              btn.setAttribute("data-value", valueid);
              btn.onclick = () => sendUpdate(fieldName, valueid);
              cell.appendChild(btn);
            });
          }

          container.appendChild(cell);
        }
      });
    }

    createGrid();
  </script>
</body>
</html>
